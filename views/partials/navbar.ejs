<div class="navbar">
    <div class="nav">
        <ul class="nav-links">
            <li class="nav-item">
                <a class="nav-link" href="/">
                    <img src="https://cdn.worldvectorlogo.com/logos/webdev-1.svg" alt="" class="logo">
                </a>
            </li>
            
            <li class="nav-item">
                <a class="nav-link" aria-current="page" href="project">Dự án</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="contact">Liên hệ</a>
            </li>
            <li class="nav-item updating">
                <a class="nav-link" href="/">Updating...</a>
            </li>
            <!-- <li class="nav-item">
                <a class="nav-link" href="khoga">khoga</a>
            </li> -->
        </ul>
        <div class="nav-account">
            <a href="/login"><button class="login-btn">Đăng nhập</button></a>
            <a href="/register"><button class="login-btn">Đăng ký</button></a>
        </div>
        <div class="nav-user">
            <img src="" alt="" class="nav-user-avatar">
            <span class="nav-user-disname"></span>
            <button class="nav-log-out-btn">Đăng xuất</button>
        </div>
    </div>
</div>

<script type="module">
    const loginForm = document.querySelector(".login-form")
    const navAccount = document.querySelector(".nav-account")           
    const navUser = document.querySelector(".nav-user")
    const navUserAvatar = document.querySelector(".nav-user-avatar")
    const navUserDisname = document.querySelector(".nav-user-disname")
    const logOutBtn = document.querySelector(".nav-log-out-btn")

    async function validateToken(token) {
        const res = await fetch("https://nathinh-blog.onrender.com/api/validate-token", {
            headers: { "Authorization": `Bearer ${token}` }
        })
        
        if(!res.ok) throw new Error("Invalid token")
        return res.json()
    }

    const token = localStorage.getItem('accessToken')            
    if (token) {
        validateToken(token)
            .then(user => {
                navAccount.style.display = "none"
                navUser.style.display = "flex"
                navUserDisname.innerHTML = user.displayName
                navUserAvatar.src = user.avatar
            })
            .catch(err => {
                localStorage.removeItem('accessToken')
                console.log(err);
            })
    }

    logOutBtn.addEventListener('click', (e) => {
        localStorage.removeItem('accessToken')
        navAccount.style.display = "flex"
        navUser.style.display = "none"
    })
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>